<% @posts.each do |post| %>
<div class="post_box">
    <div class="post_header">
         <%= image_tag post.user.photo,class:'prof_pic_small' %>
        <!--In this case, post is the placeholder variable in the each loop, representing a single Post from the @posts collection. -->
        <!-- Since Post belongs to User, Rails allows you to call the user that owns the Post by doing post.user. -->
        
        <%= link_to post.user.name, user_path(post.user.id) %> 
        <span class="timestamp pull-right"><%= distance_of_time_in_words(DateTime.now, post.created_at) %> ago</span>
    </div>
   
    <%= image_tag post.photo, class: 'photo' %>
    
    
    
    <% if post.user == current_user %>
        <div class="panel panel-default">
                <div class="post_body">
                     <%= post.description %>
                </div>
                
            <div class="panel-body">
                    <button type="button" class="btn btn-default">
                        <%= link_to 'Edit Post', edit_post_path(post.id) %>
                    </button>
                    <button type="button" class="btn btn-default">
                        <%= link_to 'Delete Post', post_path(post.id), method: :delete %>
                    </button>
                    <button type="button" class="btn btn-default">
                        <%= link_to 'Go to post', post_path(post.id) %> 
                    </button>
            </div>
        </div>
    <% else %>
    <div class="panel panel-default">
                <div class="post_body">
                     <%= post.description %>
                </div>
            <div class="panel-body">
                <button type="button" class="btn btn-default">
                    <%= link_to 'Go to post', post_path(post.id) %> 
                </button>
            </div>
        </div>
    <% end %>
    
    
    <div class="post_comments">
        <% post.comments.each do |comment| %>
             <div class="panel panel-default">
                    <div class="panel-body">
                            <%= comment.user.name %>: <%= comment.text %>
                            <% if comment.user == current_user %> 
                                <%= link_to 'Edit', edit_post_comment_path(post_id: post.id, id: comment.id), method: :get %>
                                <%= link_to 'Delete', post_comment_path(post_id: post.id, id: comment.id), method: :delete %>
                            
                            <% end %>
                     </div>
             </div>
        <% end %>
    
        <hr>
        
        <% if user_signed_in? %>
            <span class="post_like">
                <% if current_user.voted_up_on? post %>
                    <%= link_to '<i class="fa fa-heart" aria-hidden="true"></i>'.html_safe, post_downvotes_path(post.id), method: :post %>
                    <%#= with the remote: true, it processed the request as JS, and without it, it process the request as HTML. %>
                    <% else %>
                        <%= link_to '<i class="fa fa-heart-o" aria-hidden="true"></i>'.html_safe,post_upvotes_path(post.id), method: :post, remote: true %>
                    <% end %>
                  <%= pluralize post.get_likes.size, "like" %>
            </span>
        

        <% else %>
        <span class="post_like">
            <i class="fa fa-heart-o" aria-hidden="true"></i> <%= pluralize post.get_likes.size, "like" %>
        </span>
        <% end %>
    
        <% if user_signed_in? %>
            <%= simple_form_for Comment.new, url: post_comments_path(post), method: :post, html: { class:'form-horizontal'} do |f| %>
                <%= f.input :text, label: 'Comment', placeholder: 'Add a comment...' %>
                <%= f.submit 'Post', class: 'btn btn-primary btn-block' %>
            <% end %>
        <% end %> 
    </div>
</div>

<% end %>